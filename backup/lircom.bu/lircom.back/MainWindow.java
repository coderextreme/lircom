/*
 * Alfav02.java
 *
 * Created on February 12, 2005, 11:59 PM
 */

package lircom;

//import org.web3d.x3d.sai.*;

/**
 *
 * @author  hivechild
 */
public class MainWindow extends javax.swing.JFrame implements java.awt.event.WindowListener {
    
    /** Creates new form Alfav02 */
    public MainWindow(String title) throws Exception {
        super(title);
        initComponents();
        // Main_Menu.getPopupMenu().setLightWeightPopupEnabled(false);
        scrollingText.getViewport().setOpaque(false);
	// new Orbit(jLayeredPane2).start();
        // jLayeredPane2.add(new Orbit4().getFrame(), javax.swing.JLayeredPane.PALETTE_LAYER);
	addWindowListener(this);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        jLayeredPane2 = new javax.swing.JLayeredPane();
        jPanel1 = new javax.swing.JPanel();
        scrollingText = new javax.swing.JScrollPane();
        chat_Info_Area = new javax.swing.JEditorPane();
        member_List = new javax.swing.JList();
        chat_Text_Field = new javax.swing.JTextField();
        backgroundImage = new javax.swing.JLabel();
        main_Menu_Bar = new javax.swing.JMenuBar();
        Main_Menu = new javax.swing.JMenu();
        Menu_Options = new javax.swing.JMenuItem();
        selectBackgroundImage = new javax.swing.JMenuItem();
        selectDefaultTextColor = new javax.swing.JMenuItem();
        selectConnections = new javax.swing.JMenuItem();
        selectAdvertiseService = new javax.swing.JMenuItem();
        setBrowser = new javax.swing.JMenuItem();
        addChannel = new javax.swing.JMenuItem();
        followHyperlinks = new javax.swing.JCheckBoxMenuItem();
        solitaireMenu = new javax.swing.JMenu();
        watchSolitaire = new javax.swing.JMenuItem();
        dealSolitaire = new javax.swing.JMenuItem();
        randomPlayer = new javax.swing.JMenuItem();
        methodicalPlayer = new javax.swing.JMenuItem();
        flushContacts = new javax.swing.JMenuItem();
        flashchat = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("LirCom");
        setName("Lircom");
        jPanel1.setLayout(new java.awt.GridBagLayout());

        jPanel1.setDoubleBuffered(false);
        jPanel1.setMinimumSize(new java.awt.Dimension(800, 445));
        jPanel1.setOpaque(false);
        jPanel1.setPreferredSize(new java.awt.Dimension(800, 445));
        scrollingText.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
        scrollingText.setAlignmentY(1.0F);
        scrollingText.setAutoscrolls(true);
        scrollingText.setMinimumSize(new java.awt.Dimension(700, 420));
        scrollingText.setOpaque(false);
        scrollingText.setPreferredSize(new java.awt.Dimension(719, 420));
        chat_Info_Area.setToolTipText("chat history window");
        chat_Info_Area.setContentType("text/html");
        chat_Info_Area.setOpaque(false);
        chat_Info_Area.setPreferredSize(new java.awt.Dimension(700, 450));
        scrollingText.setViewportView(chat_Info_Area);

        jPanel1.add(scrollingText, new java.awt.GridBagConstraints());

        member_List.setBackground(new java.awt.Color(0, 0, 0));
        member_List.setForeground(new java.awt.Color(255, 255, 204));
        member_List.setToolTipText("Chatter List");
        member_List.setLayoutOrientation(javax.swing.JList.VERTICAL_WRAP);
        member_List.setMinimumSize(new java.awt.Dimension(100, 420));
        member_List.setNextFocusableComponent(chat_Text_Field);
        member_List.setOpaque(false);
        member_List.setPreferredSize(new java.awt.Dimension(100, 420));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.gridheight = java.awt.GridBagConstraints.RELATIVE;
        jPanel1.add(member_List, gridBagConstraints);

        chat_Text_Field.setBackground(new java.awt.Color(0, 0, 0));
        chat_Text_Field.setForeground(new java.awt.Color(204, 255, 204));
        chat_Text_Field.setText("type here");
        chat_Text_Field.setCaretColor(new java.awt.Color(255, 255, 255));
        chat_Text_Field.setMinimumSize(new java.awt.Dimension(800, 25));
        chat_Text_Field.setNextFocusableComponent(member_List);
        chat_Text_Field.setPreferredSize(new java.awt.Dimension(800, 25));
        chat_Text_Field.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chat_Text_FieldActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.gridheight = java.awt.GridBagConstraints.REMAINDER;
        jPanel1.add(chat_Text_Field, gridBagConstraints);

        jPanel1.setBounds(0, 0, 800, 445);
        jLayeredPane2.add(jPanel1, javax.swing.JLayeredPane.DRAG_LAYER);

        backgroundImage.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        backgroundImage.setIcon(new javax.swing.ImageIcon(getClass().getResource("/lircom/Space_Tears_II.jpg")));
        backgroundImage.setVerticalAlignment(javax.swing.SwingConstants.TOP);
        backgroundImage.setAlignmentY(1.0F);
        backgroundImage.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/lircom/Space_Tears_II.jpg")));
        backgroundImage.setOpaque(true);
        backgroundImage.setBounds(0, 0, 800, 455);
        jLayeredPane2.add(backgroundImage, javax.swing.JLayeredPane.DEFAULT_LAYER);

        getContentPane().add(jLayeredPane2, java.awt.BorderLayout.CENTER);

        Main_Menu.setText("Menu");
        Main_Menu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Main_MenuActionPerformed(evt);
            }
        });

        Menu_Options.setText("Options");
        Main_Menu.add(Menu_Options);

        selectBackgroundImage.setText("Select Background Image");
        selectBackgroundImage.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                popupFileDialog(evt);
            }
        });

        Main_Menu.add(selectBackgroundImage);

        selectDefaultTextColor.setText("Select Text Color");
        selectDefaultTextColor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectDefaultTextColorActionPerformed(evt);
            }
        });

        Main_Menu.add(selectDefaultTextColor);

        selectConnections.setText("Connections");
        selectConnections.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectConnectionsActionPerformed(evt);
            }
        });

        Main_Menu.add(selectConnections);

        selectAdvertiseService.setText("Advertise Service");
        selectAdvertiseService.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectAdvertiseServiceActionPerformed(evt);
            }
        });

        Main_Menu.add(selectAdvertiseService);

        setBrowser.setText("Set Web Browser");
        setBrowser.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                setBrowserActionPerformed(evt);
            }
        });

        Main_Menu.add(setBrowser);

        addChannel.setText("Add Channel");
        addChannel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addChannelActionPerformed(evt);
            }
        });

        Main_Menu.add(addChannel);

        followHyperlinks.setText("Follow Hyperlinks");
        followHyperlinks.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                followHyperlinksActionPerformed(evt);
            }
        });

        Main_Menu.add(followHyperlinks);

        solitaireMenu.setText("Solitaire");
        solitaireMenu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                solitaireMenuActionPerformed(evt);
            }
        });

        watchSolitaire.setText("Watch");
        watchSolitaire.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                watchSolitaireActionPerformed(evt);
            }
        });

        solitaireMenu.add(watchSolitaire);

        dealSolitaire.setText("Deal");
        dealSolitaire.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dealSolitaireActionPerformed(evt);
            }
        });

        solitaireMenu.add(dealSolitaire);

        randomPlayer.setText("Computer Plays Randomly");
        randomPlayer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                randomPlayerActionPerformed(evt);
            }
        });

        solitaireMenu.add(randomPlayer);

        methodicalPlayer.setText("Computer Plays Methodically");
        methodicalPlayer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                methodicalPlayerActionPerformed(evt);
            }
        });

        solitaireMenu.add(methodicalPlayer);

        Main_Menu.add(solitaireMenu);

        flushContacts.setText("Flush Contacts");
        flushContacts.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                flushContactsActionPerformed(evt);
            }
        });

        Main_Menu.add(flushContacts);

        flashchat.setText("Flashchat");
        flashchat.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                flashchatActionPerformed(evt);
            }
        });

        Main_Menu.add(flashchat);

        main_Menu_Bar.add(Main_Menu);

        setJMenuBar(main_Menu_Bar);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-800)/2, (screenSize.height-500)/2, 800, 500);
    }//GEN-END:initComponents

    private void flashchatActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_flashchatActionPerformed
	    try {
		Runestone r = new Runestone(chat, nickname);
	    } catch (Exception e) {
	    }
    }//GEN-LAST:event_flashchatActionPerformed

    private void flushContactsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_flushContactsActionPerformed
        chat.flushContacts();
    }//GEN-LAST:event_flushContactsActionPerformed

    private void randomPlayerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_randomPlayerActionPerformed
        try {
            startSolitaire("random");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_randomPlayerActionPerformed

    private void dealSolitaireActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dealSolitaireActionPerformed
        try {
            startSolitaire("dealer");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_dealSolitaireActionPerformed

    private void methodicalPlayerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_methodicalPlayerActionPerformed
        try {
            startSolitaire("methodical");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_methodicalPlayerActionPerformed

    private void solitaireMenuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_solitaireMenuActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_solitaireMenuActionPerformed

    private void Main_MenuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Main_MenuActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_Main_MenuActionPerformed

    private void watchSolitaireActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_watchSolitaireActionPerformed
        try {
            startSolitaire("display");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_watchSolitaireActionPerformed

    private void followHyperlinksActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_followHyperlinksActionPerformed
        chat_Info_Area.setEditable(!chat_Info_Area.isEditable());
    }//GEN-LAST:event_followHyperlinksActionPerformed

    private void addChannelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addChannelActionPerformed
        try {
 
		String classname = javax.swing.JOptionPane.showInputDialog(this, "Enter classname:", "lircom.Channel");
		MainWindow newChannel = new MainWindow(classname);
		newChannel.nickname = javax.swing.JOptionPane.showInputDialog(this, "Enter nickname:", "Guest");
		newChannel.setTitle(newChannel.nickname);
		newChannel.setChat(classname, newChannel.nickname);
		newChannel.setVisible(true);
		newChannel.setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
		// newChannel.bridge = new IRCBridge(newChannel.chat, newChannel.nickname);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_addChannelActionPerformed

    private void setBrowserActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_setBrowserActionPerformed
        javax.swing.JFileChooser chooser = new javax.swing.JFileChooser();
        if (currentBrowserDirectory != null) {
          chooser.setCurrentDirectory(currentBrowserDirectory);
        }
        int returnVal = chooser.showOpenDialog(this);
        if(returnVal == javax.swing.JFileChooser.APPROVE_OPTION) {
            browser = chooser.getSelectedFile().getAbsolutePath();
            hyperlinkHandler.setBrowser(browser);
            currentBrowserDirectory = chooser.getCurrentDirectory();
        }
    }//GEN-LAST:event_setBrowserActionPerformed

    private void selectAdvertiseServiceActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectAdvertiseServiceActionPerformed
        if (serverAdvertise == null) {
                serverAdvertise = new ServerAdvertise();
        }
        serverAdvertise.setChat(chat);
        serverAdvertise.setVisible(true);
        serverAdvertise.setTitle("serverAdvertise");
    }//GEN-LAST:event_selectAdvertiseServiceActionPerformed

    private void selectConnectionsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectConnectionsActionPerformed
        if (clientConnect == null) {
            clientConnect = new ClientConnect(this);
        }
        clientConnect.setVisible(true);
        clientConnect.harvest();
    }//GEN-LAST:event_selectConnectionsActionPerformed

    private void selectDefaultTextColorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectDefaultTextColorActionPerformed
        // TODO add your handling code here:
        if (currentTextColor == null) {
               currentTextColor =  java.awt.Color.getColor("#FFFFFF");
        }
        if (currentTextColor == null) {
            currentTextColor = java.awt.Color.WHITE;
        }
        javax.swing.JColorChooser chooser = new javax.swing.JColorChooser(currentTextColor);
        currentTextColor = chooser.showDialog(this, "Select default text color", currentTextColor);
        String red = Integer.toHexString(currentTextColor.getRed());
        if (red.length() == 1) {
                red = "0"+red;
        }
        String green = Integer.toHexString(currentTextColor.getGreen());
        if (green.length() == 1) {
                green = "0"+green;
        }
        String blue = Integer.toHexString(currentTextColor.getBlue());
        if (blue.length() == 1) {
                blue = "0"+blue;
        }
        String color = "#"+red+green+blue;
        chat.setColor(color);
    }//GEN-LAST:event_selectDefaultTextColorActionPerformed

    private void chat_Text_FieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chat_Text_FieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_chat_Text_FieldActionPerformed

    private void popupFileDialog(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_popupFileDialog
    javax.swing.JFileChooser chooser = new javax.swing.JFileChooser();
    if (currentDirectory != null) {
        chooser.setCurrentDirectory(currentDirectory);
    }
    // Note: source for ExampleFileFilter can be found in FileChooserDemo,
    // under the demo/jfc directory in the Java 2 SDK, Standard Edition.
    ExampleFileFilter filter = new ExampleFileFilter();
    filter.addExtension("jpg");
    filter.addExtension("gif");
    filter.setDescription("JPG & GIF Images");
    chooser.setFileFilter(filter);
    int returnVal = chooser.showOpenDialog(this);
    if(returnVal == javax.swing.JFileChooser.APPROVE_OPTION) {
        backgroundImage.setIcon(new javax.swing.ImageIcon(chooser.getSelectedFile().getAbsolutePath()));
        currentDirectory = chooser.getCurrentDirectory();
    }
    }//GEN-LAST:event_popupFileDialog
    
    /**
     * @param args the command line arguments
     */
    static String[] args;
    public static void main(String chatargs[]) {
	args = chatargs;
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
		try {
			MainWindow lircomwindow = new MainWindow("LirCom");
			String classname = "lircom.Chat";
			if (args.length > 0) {
				classname = args[0];
			} else {
				classname = javax.swing.JOptionPane.showInputDialog("Enter classname:", "lircom.Chat");
			}
			if (classname == null) {
				classname = "lircom.Chat";
			}
			lircomwindow.nickname = "Guest";
			if (args.length > 1) {
				lircomwindow.nickname = args[1];
			} else {
				lircomwindow.nickname = javax.swing.JOptionPane.showInputDialog("Enter nickname:");
			}
			if (lircomwindow.nickname == null) {
				lircomwindow.nickname = "Guest";
			}
			lircomwindow.setTitle(lircomwindow.nickname);
			lircomwindow.setChat(classname, lircomwindow.nickname);
		
                        lircomwindow.setVisible(true);
                        // lircomwindow.selectConnectionsActionPerformed(null);
			lircomwindow.bridge = new IRCBridge(lircomwindow.chat, lircomwindow.nickname);
                        // lircomwindow.flashchatActionPerformed(null);
 
                } catch (Exception e) {
			System.err.println("Died");
			e.printStackTrace();
		}
                
            }
        });
    }
    public void setChat(String classname, String nickname) throws Exception {
		try {
			chat = (Chat)(Class.forName(classname).newInstance());
		} catch (Exception e) {
			chat = new Chat();
		}
		chat.setNick(nickname);
		init(chat);
    }
    public void connect(String server, int port) throws Exception {
		ClientOnServer client = new ClientOnServer(server, port);
		client.start();
    }
    public void init(Chat chat) throws Exception {
		FromGUI fg = new FromGUI();
		FromServer fs = new FromServer();
		chat.setInputStream(fg);
		chat.setOutputStream(fs);
		fs.setChat(chat);
                //chat.connect(remoteServer, remotePort); 
                System.err.println("Channel id is "+chat.clientno);
                
                chat.jp = member_List;
                chat.tf = chat_Text_Field;
                chat.ta = chat_Info_Area;
                chat.init();
                chat.start();
                hyperlinkHandler = new Hyperactive();
                chat_Info_Area.addHyperlinkListener(hyperlinkHandler);
    }
    public void startSolitaire(String mode) throws Exception {
            solitaire.Game g = new solitaire.Game();
            java.util.Iterator i = PossibleConnection.iterator();

            while (i.hasNext()) {
                PossibleConnection pcon = (PossibleConnection)
                    PossibleConnection.get(i.next());
                if (pcon.connected) {
                    try {
                        g.startGame(mode, pcon.host, Integer.parseInt(pcon.port), nickname);
                        return;
                    } catch (Exception ex) {
                        ex.printStackTrace();
                        pcon.connected = false;
                    }
                }
 
            }
            selectConnectionsActionPerformed(null);      
    }
public void 	windowActivated(java.awt.event.WindowEvent e) {}
public void 	windowClosed(java.awt.event.WindowEvent e) {}
public void 	windowClosing(java.awt.event.WindowEvent e) { System.exit(0); }
public void 	windowDeactivated(java.awt.event.WindowEvent e) {}
public void 	windowDeiconified(java.awt.event.WindowEvent e) {}
public void 	windowIconified(java.awt.event.WindowEvent e) {}
public void 	windowOpened(java.awt.event.WindowEvent e) {}
    private String nickname;
    private Hyperactive hyperlinkHandler;
    private String browser;
    private java.io.File currentBrowserDirectory;
    private ServerAdvertise serverAdvertise;
    private ClientConnect clientConnect;
    private IRCBridge bridge;
    public Chat chat;
    private java.awt.Color currentTextColor;
    private java.io.File currentDirectory;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JMenu Main_Menu;
    private javax.swing.JMenuItem Menu_Options;
    private javax.swing.JMenuItem addChannel;
    private javax.swing.JLabel backgroundImage;
    private javax.swing.JEditorPane chat_Info_Area;
    private javax.swing.JTextField chat_Text_Field;
    private javax.swing.JMenuItem dealSolitaire;
    private javax.swing.JMenuItem flashchat;
    private javax.swing.JMenuItem flushContacts;
    private javax.swing.JCheckBoxMenuItem followHyperlinks;
    private javax.swing.JLayeredPane jLayeredPane2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JMenuBar main_Menu_Bar;
    private javax.swing.JList member_List;
    private javax.swing.JMenuItem methodicalPlayer;
    private javax.swing.JMenuItem randomPlayer;
    private javax.swing.JScrollPane scrollingText;
    private javax.swing.JMenuItem selectAdvertiseService;
    private javax.swing.JMenuItem selectBackgroundImage;
    private javax.swing.JMenuItem selectConnections;
    private javax.swing.JMenuItem selectDefaultTextColor;
    private javax.swing.JMenuItem setBrowser;
    private javax.swing.JMenu solitaireMenu;
    private javax.swing.JMenuItem watchSolitaire;
    // End of variables declaration//GEN-END:variables
    
}
